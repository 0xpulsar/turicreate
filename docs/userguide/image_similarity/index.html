
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <title>Image similarity Â· GitBook</title>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.0">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../object_detection/" />
    
    
    <link rel="prev" href="../image_classifier/how-it-works.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../sframe/">
            
                <a href="../sframe/">
            
                    
                    Working with data
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../sframe/tabular-data.html">
            
                <a href="../sframe/tabular-data.html">
            
                    
                    Tabular data
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.1" data-path="../sframe/sframe-intro.html">
            
                <a href="../sframe/sframe-intro.html">
            
                    
                    Loading and Saving
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2" data-path="../sframe/data-manipulation.html">
            
                <a href="../sframe/data-manipulation.html">
            
                    
                    Data Manipulation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.3" data-path="../data_formats_and_sources/sql_integration.html">
            
                <a href="../data_formats_and_sources/sql_integration.html">
            
                    
                    SQL Databases
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../sgraph/sgraph.html">
            
                <a href="../sgraph/sgraph.html">
            
                    
                    Graph data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../text/analysis.html">
            
                <a href="../text/analysis.html">
            
                    
                    Text data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../vis/">
            
                <a href="../vis/">
            
                    
                    Visualization
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.4.1" data-path="../vis/gallery.html">
            
                <a href="../vis/gallery.html">
            
                    
                    Example Gallery
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.2" data-path="../vis/use_cases.html">
            
                <a href="../vis/use_cases.html">
            
                    
                    Sample Use Cases
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../applications/">
            
                <a href="../applications/">
            
                    
                    Task focused toolkits
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../recommender/">
            
                <a href="../recommender/">
            
                    
                    Recommender systems
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1" data-path="../recommender/using-trained-models.html">
            
                <a href="../recommender/using-trained-models.html">
            
                    
                    Using models
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.2" data-path="../recommender/choosing-a-model.html">
            
                <a href="../recommender/choosing-a-model.html">
            
                    
                    Choosing a model
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../image_classifier/">
            
                <a href="../image_classifier/">
            
                    
                    Image classification
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.1" data-path="../image_classifier/advanced-usage.html">
            
                <a href="../image_classifier/advanced-usage.html">
            
                    
                    Advanced Usage
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.2" data-path="../image_classifier/how-it-works.html">
            
                <a href="../image_classifier/how-it-works.html">
            
                    
                    How it works
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter active" data-level="1.3.3" data-path="./">
            
                <a href="./">
            
                    
                    Image similarity
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../object_detection/">
            
                <a href="../object_detection/">
            
                    
                    Object detection
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.4.1" data-path="../object_detection/data-preparation.html">
            
                <a href="../object_detection/data-preparation.html">
            
                    
                    Data Preparation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.2" data-path="../object_detection/advanced-usage.html">
            
                <a href="../object_detection/advanced-usage.html">
            
                    
                    Advanced Usage
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.3" data-path="../object_detection/how-it-works.html">
            
                <a href="../object_detection/how-it-works.html">
            
                    
                    How it works
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../activity_classifier/">
            
                <a href="../activity_classifier/">
            
                    
                    Activity classification
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.5.1" data-path="../activity_classifier/data-preparation.html">
            
                <a href="../activity_classifier/data-preparation.html">
            
                    
                    Data Preparation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5.2" data-path="../activity_classifier/advanced-usage.html">
            
                <a href="../activity_classifier/advanced-usage.html">
            
                    
                    Advanced Usage
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5.3" data-path="../activity_classifier/export_coreml.html">
            
                <a href="../activity_classifier/export_coreml.html">
            
                    
                    Deployment to CoreML
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5.4" data-path="../activity_classifier/how-it-works.html">
            
                <a href="../activity_classifier/how-it-works.html">
            
                    
                    How it works
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="../text_classifier/">
            
                <a href="../text_classifier/">
            
                    
                    Text classifier
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../modeling-data/">
            
                <a href="../modeling-data/">
            
                    
                    Machine learning essentials
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../supervised-learning/classifier.html">
            
                <a href="../supervised-learning/classifier.html">
            
                    
                    Classification
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1.1" data-path="../supervised-learning/boosted_trees_classifier.html">
            
                <a href="../supervised-learning/boosted_trees_classifier.html">
            
                    
                    Boosted Trees Classifier
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.2" data-path="../supervised-learning/decision_tree_classifier.html">
            
                <a href="../supervised-learning/decision_tree_classifier.html">
            
                    
                    Decision Tree Classifier
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.3" data-path="../supervised-learning/logistic-regression.html">
            
                <a href="../supervised-learning/logistic-regression.html">
            
                    
                    Logistic Regression
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.4" data-path="../supervised-learning/knn_classifier.html">
            
                <a href="../supervised-learning/knn_classifier.html">
            
                    
                    Nearest Neighbor Classifier
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.5" data-path="../supervised-learning/random_forest_classifier.html">
            
                <a href="../supervised-learning/random_forest_classifier.html">
            
                    
                    Random Forest Classifier
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.6" data-path="../supervised-learning/svm.html">
            
                <a href="../supervised-learning/svm.html">
            
                    
                    SVM
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../clustering/">
            
                <a href="../clustering/">
            
                    
                    Clustering
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.2.1" data-path="../clustering/kmeans.html">
            
                <a href="../clustering/kmeans.html">
            
                    
                    KMeans
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.2" data-path="../clustering/dbscan.html">
            
                <a href="../clustering/dbscan.html">
            
                    
                    DBSCAN
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../graph_analytics/">
            
                <a href="../graph_analytics/">
            
                    
                    Graph analytics
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../nearest_neighbors/nearest_neighbors.html">
            
                <a href="../nearest_neighbors/nearest_neighbors.html">
            
                    
                    Nearest neighbors
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../supervised-learning/regression.html">
            
                <a href="../supervised-learning/regression.html">
            
                    
                    Regression
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.5.1" data-path="../supervised-learning/boosted_trees_regression.html">
            
                <a href="../supervised-learning/boosted_trees_regression.html">
            
                    
                    Boosted Trees Regression
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.2" data-path="../supervised-learning/decision_tree_regression.html">
            
                <a href="../supervised-learning/decision_tree_regression.html">
            
                    
                    Decision Tree Regression
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.3" data-path="../supervised-learning/linear-regression.html">
            
                <a href="../supervised-learning/linear-regression.html">
            
                    
                    Linear Regression
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.4" data-path="../supervised-learning/random_forest_regression.html">
            
                <a href="../supervised-learning/random_forest_regression.html">
            
                    
                    Random Forest Regression
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../text/">
            
                <a href="../text/">
            
                    
                    Text analysis
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../evaluation/">
            
                <a href="../evaluation/">
            
                    
                    Evaluating models
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../evaluation/regression.html">
            
                <a href="../evaluation/regression.html">
            
                    
                    Regression metrics
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../evaluation/classification.html">
            
                <a href="../evaluation/classification.html">
            
                    
                    Classification metrics
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../deployment/">
            
                <a href="../deployment/">
            
                    
                    Deployment
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../conclusion.html">
            
                <a href="../conclusion.html">
            
                    
                    Additional Resources
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../cpp.html">
            
                <a href="../cpp.html">
            
                    
                    C++ API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../datasets.html">
            
                <a href="../datasets.html">
            
                    
                    Dataset Disclaimer
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Image similarity</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="image-similarity"><a name="image-similarity" class="plugin-anchor" href="#image-similarity"><i class="fa fa-link" aria-hidden="true"></i></a>Image similarity</h1><p>Given an image, the goal of an image similarity model is to find
&quot;similar&quot; images. Just like in <a href="../image_classifier/">image
classification</a>, deep learning
methods have been shown to give incredible results on this challenging
problem. However, unlike in image similarity, there isn&apos;t a need to
generate labeled images for model creation. This model is completely
unsupervised.</p><h4 id="creating-the-model"><a name="creating-the-model" class="plugin-anchor" href="#creating-the-model"><i class="fa fa-link" aria-hidden="true"></i></a>Creating the model</h4><p>In this example, we use the <a href="http://www.vision.caltech.edu/Image_Datasets/Caltech101/" target="_blank">Caltech-101
dataset</a>
which contains images objects belonging to 101 categories with about 40
to 800 images per category.<a href="../datasets.html"><sup>1</sup></a></p><pre><code class="lang-python"><span class="hljs-keyword">import</span> turicreate <span class="hljs-keyword">as</span> tc

<span class="hljs-comment"># Load images from the downloaded data</span>
reference_data  = tc.image_analysis.load_images(<span class="hljs-string">&apos;./101_ObjectCategories&apos;</span>)
reference_data = reference_data.add_row_number()

<span class="hljs-comment"># Save the data for future use</span>
reference_data.save(<span class="hljs-string">&apos;caltech-101.sframe&apos;</span>)</code></pre>
<p>We can explore the data interactively using:</p><pre><code class="lang-python">reference_data.explore()</code></pre>
<p>Next, we create an <strong>image similarity</strong> model using the data (commonly
called <strong>reference data</strong>)</p><pre><code class="lang-python">model = tc.image_similarity.create(reference_data)</code></pre>
<h4 id="querying-the-model"><a name="querying-the-model" class="plugin-anchor" href="#querying-the-model"><i class="fa fa-link" aria-hidden="true"></i></a>Querying the model</h4><p>Once created, we can query the model to retrieve the ten closest images
in the original reference data (by setting the <code>k</code> parameter to <code>10</code>).
The result of the query method is an SFrame with four columns: query
label, reference label, distance, and rank of the reference point 
among the query point&apos;s nearest neighbors.</p><p><em>Note: You can pass in an image, or an SArray of images into the <code>model.query</code></em>
<em>method. This image or array of images does <strong>not</strong> need to be a part of the</em>
<em>original dataset.</em></p><pre><code class="lang-python">similar_images = model.query(reference_data[<span class="hljs-number">0</span>:<span class="hljs-number">10</span>], k=<span class="hljs-number">10</span>)
similar_images.head()</code></pre>
<pre><code class="lang-no-highlight">+-------------+-----------------+---------------+------+
| query_label | reference_label |    distance   | rank |
+-------------+-----------------+---------------+------+
|      0      |        0        |      0.0      |  1   |
|      0      |       2557      | 18.3461090355 |  2   |
|      0      |       7000      | 18.3861360371 |  3   |
|      0      |       2664      |  18.655464356 |  4   |
|      0      |       1968      |  18.887705352 |  5   |
|      0      |       7764      | 19.0063301087 |  6   |
|      0      |       4296      | 19.0114573751 |  7   |
|      0      |       221       | 19.1188139256 |  8   |
|      0      |       1361      | 19.1415785143 |  9   |
|      0      |       1148      | 19.1690505999 |  10  |
+-------------+-----------------+---------------+------+
[100 rows x 4 columns]</code></pre>
<p>Now, for a simple image like this (let&apos;s say the 9th image in the data)</p><pre><code class="lang-python">reference_data[<span class="hljs-number">9</span>].show()</code></pre>
<p><img alt="Similar images" src="images/sample_image.jpg"></p><p>The 10 most &quot;similar&quot; looking images are</p><pre><code class="lang-python">similar_images[similar_images[<span class="hljs-string">&apos;query_label&apos;</span>] == <span class="hljs-number">9</span>].explore()</code></pre>
<p><img alt="Similar images" src="images/similar_images.png"></p><h4 id="similarity-graph"><a name="similarity-graph" class="plugin-anchor" href="#similarity-graph"><i class="fa fa-link" aria-hidden="true"></i></a>Similarity graph</h4><p>In some cases, we want to find the most similar images in the reference
dataset for all images in the reference dataset. The similarity_graph
method returns an SGraph whose vertices are the rows of the reference
dataset and whose edges indicate a nearest neighbor match. Specifically,
the destination vertex of an edge is a nearest neighbor of the source
vertex. <code>similarity_graph</code> can also return results in the same form as the
query method if so desired.</p><pre><code class="lang-python">similarity_graph = model.similarity_graph(k=<span class="hljs-number">10</span>)
similar_images = similarity_graph.edges</code></pre>
<pre><code class="lang-no-highlight">+----------+----------+---------------+------+
| __src_id | __dst_id |    distance   | rank |
+----------+----------+---------------+------+
|   1145   |   3031   | 16.6532360195 |  1   |
|   1145   |   8627   | 16.7883178946 |  2   |
|   1145   |   8559   | 16.9748661517 |  3   |
|   1145   |   238    | 17.6599250835 |  10  |
|   1158   |   4523   | 17.0756179217 |  2   |
|   1161   |   7422   | 16.9777686727 |  2   |
|   1161   |   1203   | 17.1384324655 |  7   |
|   1180   |   6636   | 16.7749244209 |  9   |
|   1182   |   3276   | 16.8179663995 |  5   |
|   1182   |   7717   |  16.889624839 |  6   |
+----------+----------+---------------+------+
[91440 rows x 4 columns]</code></pre>
<h5 id="saving-the-model"><a name="saving-the-model" class="plugin-anchor" href="#saving-the-model"><i class="fa fa-link" aria-hidden="true"></i></a>Saving the model</h5><p>Once you have created a model, you can save it and load it back later for use.</p><pre><code>model.save(&apos;myModel.model&apos;)
loaded_model = turicreate.load_model(&apos;myModel.model&apos;)</code></pre>
<h5 id="deploying-to-core-ml"><a name="deploying-to-core-ml" class="plugin-anchor" href="#deploying-to-core-ml"><i class="fa fa-link" aria-hidden="true"></i></a>Deploying to Core ML</h5><p>Using the Core ML Framework, you can retrieve the distance between a query image and all images in the reference data. Exporting this model in Core ML format can be
performed using the <code>export_coreml</code> function.</p><pre><code class="lang-python">model.export_coreml(<span class="hljs-string">&apos;MyImageSimilarityModel.mlmodel&apos;</span>)</code></pre>
<p>When you open the model in Xcode, it looks like the following:</p><p><img alt="Image similarity model in Xcode" src="images/image_similarity_model.png"></p><p>The following Swift code is needed to consume the model in
an iOS app.</p><pre><code class="lang-swift"><span class="hljs-keyword">let</span> model = <span class="hljs-keyword">try</span> <span class="hljs-type">VNCoreMLModel</span>(<span class="hljs-keyword">for</span>: <span class="hljs-type">MyImageSimilarityModel</span>().model)

<span class="hljs-keyword">let</span> request = <span class="hljs-type">VNCoreMLRequest</span>(model: model, completionHandler: { [<span class="hljs-keyword">weak</span> <span class="hljs-keyword">self</span>] request, error <span class="hljs-keyword">in</span>
    <span class="hljs-keyword">self</span>?.processQuery(<span class="hljs-keyword">for</span>: request, error: error)
})
request.imageCropAndScaleOption = .centerCrop
<span class="hljs-keyword">return</span> request</code></pre>
<p>Notice that the image similarity model in Core ML returns the distances between the query image and all images in the reference dataset. In order to retrieve the most similar images in the reference dataset, we must sort them by distance. We can do this by modifying the <a href="https://developer.apple.com/documentation/vision/classifying_images_with_vision_and_core_ml" target="_blank">Core ML sample application
</a> as such:</p><pre><code class="lang-swift"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">processQuery</span><span class="hljs-params">(<span class="hljs-keyword">for</span> request: VNRequest, error: Error?, k: Int = <span class="hljs-number">5</span>)</span></span> {
    <span class="hljs-type">DispatchQueue</span>.main.async {
        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> results = request.results <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">self</span>.referenceRanking.text = <span class="hljs-string">&quot;Unable to rank image.\n<span class="hljs-subst">\(error!.localizedDescription)</span>&quot;</span>
            <span class="hljs-keyword">return</span>
        }

        <span class="hljs-keyword">let</span> queryResults = results <span class="hljs-keyword">as</span>! [<span class="hljs-type">VNCoreMLFeatureValueObservation</span>]
        <span class="hljs-keyword">let</span> distances = queryResults.first!.featureValue.multiArrayValue!

        <span class="hljs-comment">// Create an array of distances to sort</span>
        <span class="hljs-keyword">let</span> numReferenceImages = distances.shape[<span class="hljs-number">0</span>].intValue
        <span class="hljs-keyword">var</span> distanceArray = [<span class="hljs-type">Double</span>]()
        <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> <span class="hljs-number">0</span>..&lt;numReferenceImages {
            distanceArray.append(<span class="hljs-type">Double</span>(distances[r]))
        }

        <span class="hljs-keyword">let</span> sorted = distanceArray.enumerated().sorted(by: {$<span class="hljs-number">0</span>.element &lt; $<span class="hljs-number">1</span>.element})
        <span class="hljs-keyword">let</span> knn = sorted[..&lt;<span class="hljs-built_in">min</span>(k, numReferenceImages)]

        <span class="hljs-keyword">self</span>.referenceRanking.text = <span class="hljs-type">String</span>(describing: knn)
    }
}</code></pre>
<h4 id="how-it-works"><a name="how-it-works" class="plugin-anchor" href="#how-it-works"><i class="fa fa-link" aria-hidden="true"></i></a>How it works</h4><p>The key ideas in the image similarity model are similar to those in
<a href="../image_classifier/how-it-works.html">image classifier</a>. When you run
the Turi Create image classifier, it breaks things down into something
like this:</p><ul><li><p><strong>Stage 1</strong>: Uses a pre-trained CNN classifier on a large, general
dataset. A good example is ImageNet, with 1000 categories and 1.2
million images.</p></li>
<li><p><strong>Stage 2</strong>: The outputs of each layer in the CNN can be viewed as a
meaningful vector representation of each image. Extract these feature
vectors from the layer prior to the output layer on each image of your
task.</p></li>
<li><p><strong>Stage 3</strong>: Create a <a href="../nearest_neighbors/nearest_neighbors.html">nearest
neighbors</a> model with those
features as input for your own task.</p></li></ul>
<h4 id="references"><a name="references" class="plugin-anchor" href="#references"><i class="fa fa-link" aria-hidden="true"></i></a>References</h4><ul><li>[1] L. Fei-Fei, R. Fergus and P.  Perona. One-Shot learning of object
categories. IEEE Trans. Pattern Recognition and Machine Intelligence.
</li></ul>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../image_classifier/how-it-works.html" class="navigation navigation-prev " aria-label="Previous page: How it works">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../object_detection/" class="navigation navigation-next " aria-label="Next page: Object detection">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Image similarity","level":"1.3.3","depth":2,"next":{"title":"Object detection","level":"1.3.4","depth":2,"path":"object_detection/README.md","ref":"object_detection/README.md","articles":[{"title":"Data Preparation","level":"1.3.4.1","depth":3,"path":"object_detection/data-preparation.md","ref":"object_detection/data-preparation.md","articles":[]},{"title":"Advanced Usage","level":"1.3.4.2","depth":3,"path":"object_detection/advanced-usage.md","ref":"object_detection/advanced-usage.md","articles":[]},{"title":"How it works","level":"1.3.4.3","depth":3,"path":"object_detection/how-it-works.md","ref":"object_detection/how-it-works.md","articles":[]}]},"previous":{"title":"How it works","level":"1.3.2.2","depth":3,"path":"image_classifier/how-it-works.md","ref":"image_classifier/how-it-works.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"3.2.0","theme":"default","variables":{},"plugins":["collapsible-menu@1.0.2","anchors@0.5.0","mathjax"],"pluginsConfig":{"collapsible-menu":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"fontSettings":{"theme":"white","family":"sans","size":2},"highlight":{},"mathjax":{"forceSVG":false,"version":"2.6-latest"},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"anchors":{}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"image_similarity/README.md","mtime":"2018-04-06T23:42:03.427Z","type":"markdown"},"gitbook":{"version":"3.2.0","time":"2018-04-13T23:44:02.321Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-collapsible-menu/plugin.js"></script>
        
    
        
        <script src="https://cdn.mathjax.org/mathjax/2.6-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-mathjax/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

